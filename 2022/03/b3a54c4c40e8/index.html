<!DOCTYPE html>
<html lang="zh-CN" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="" />
  <meta name="author" content="◢₄₆Daniel" />
  <meta name="description" content="あいうえおかきくけこ" />
  
  
  <title>
    
      群晖 Video Station 插件开发文档翻译 
      
      
      |
    
     Danielのブログ
  </title>

  
    <link rel="apple-touch-icon" href="/pictures/favicon.ico">
    <link rel="icon" href="/pictures/favicon.ico">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/color-scheme.css">
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/iconfont/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/comments.css">


  <!-- jquery3.3.1 -->
  <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <!-- fancybox -->
  <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <script async src="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  
<script src="/js/fancybox.js"></script>


  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>

<meta name="generator" content="Hexo 5.4.0"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img no-lazy src="/pictures/simple.jpg" alt="">
      
    </a>
    <div class="nickname"><a href="/">Daniel</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">主页</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">归档</a>
        </li>
      
        <li class="nav-item" data-path="/categories/">
          <a href="/categories/">分类</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">标签</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">关于</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->

<!-- LaTex Display -->
<!-- <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> -->
<script src="https://cdn.bootcdn.net/ajax/libs/babel-polyfill/7.12.1/polyfill.min.js"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
};
</script>



  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">群晖 Video Station 插件开发文档翻译</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime" title="更新时间"></i>
          2022-03-12 21:07:00
        </span>
        
              <span class="post-categories">
                <i class="iconfont icon-bookmark" title="分类"></i>
                
                <span class="span--category">
                  <a href="/categories/%E6%8C%87%E5%8D%97/" title="指南">
                    <b>#</b> 指南
                  </a>
                </span>
                
              </span>
          
              <span class="post-tags">
                <i class="iconfont icon-tags" title="标签"></i>
                
                <span class="span--tag">
                  <a href="/tags/%E7%BE%A4%E6%99%96/" title="群晖">
                    <b>#</b> 群晖
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/Video-Station/" title="Video Station">
                    <b>#</b> Video Station
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/%E7%BF%BB%E8%AF%91/" title="翻译">
                    <b>#</b> 翻译
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <p><a target="_blank" rel="noopener" href="https://global.download.synology.com/download/Addons/VideoStation/com.synology.TMDBExample.zip">下载示例代码</a></p>
<h1 id="2-信息搜索流程"><a href="#2-信息搜索流程" class="headerlink" title="2. 信息搜索流程"></a>2. 信息搜索流程</h1><p>要在 Video Station 中运行视频信息插件，主要步骤如下：</p>
<h2 id="2-1-触发视频信息搜索"><a href="#2-1-触发视频信息搜索" class="headerlink" title="2.1 触发视频信息搜索"></a>2.1 触发视频信息搜索</h2><p>单击 Video Station 中的 “从视频信息插件搜索” 按钮后，PluginSearch API 将发送请求以触发视频信息搜索。 </p>
<h2 id="2-2-转换-INFO-文件"><a href="#2-2-转换-INFO-文件" class="headerlink" title="2.2 转换 INFO 文件"></a>2.2 转换 INFO 文件</h2><p>Video Station 检查插件状态并检索插件 ID 和 INFO 文件中的入口文件路径 </p>
<h2 id="2-3-运行插件"><a href="#2-3-运行插件" class="headerlink" title="2.3 运行插件"></a>2.3 运行插件</h2><p>Video Station 找到入口文件 (loader.sh) 并以 “nobody” 权限运行它。 一旦信息搜索完成后，Video Station 将解析插件响应并将其保存到数据库 </p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/pictures/post/2022/03/1.png" alt="1"></p>
<h1 id="3-文件要求"><a href="#3-文件要求" class="headerlink" title="3. 文件要求"></a>3. 文件要求</h1><h2 id="3-1-INFO"><a href="#3-1-INFO" class="headerlink" title="3.1 INFO"></a>3.1 INFO</h2><p>INFO 文件提供插件 ID、支持的视频类型、入口文件位置和测试验证插件的示例。 内容必须使用 JSON 格式的 UTF-8 编码，通常如下所示</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;com.synology.TMDBExample&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;site&quot;</span>: <span class="string">&quot;http://www.themoviedb.org/&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;entry_file&quot;</span>: <span class="string">&quot;loader.sh&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;type&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;movie&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tvshow&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;language&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;enu&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;test_example&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;movie&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Harry Potter&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;original_available&quot;</span>: <span class="string">&quot;2001-11-16&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;tvshow&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Game of Thrones&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;original_available&quot;</span>: <span class="string">&quot;2011-04-17&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;tvshow_episode&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Game of Thrones&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;original_available&quot;</span>: <span class="string">&quot;2011-04-17&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;season&quot;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;episode&quot;</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>表1. INFO 文件的内容</strong></p>
<table>
<thead>
<tr>
<th align="center">key</th>
<th align="center">类型</th>
<th align="center">描述</th>
<th align="center">是否必须</th>
</tr>
</thead>
<tbody><tr>
<td align="center">id</td>
<td align="center">string</td>
<td align="center">唯一的插件ID，应该和插件一样,作为文件夹名称。如果插件ID重复，插件不能上传</td>
<td align="center">必须</td>
</tr>
<tr>
<td align="center">entry_file</td>
<td align="center">string</td>
<td align="center">入口文件loader.sh的相对文件路径。</td>
<td align="center">必须</td>
</tr>
<tr>
<td align="center">type</td>
<td align="center">array of string</td>
<td align="center">插件支持的视频类型，必须是以下之一：[‘movie’]、[‘tvshow’] 或 [‘movie’, ‘tvshow’]。</td>
<td align="center">必须</td>
</tr>
<tr>
<td align="center">version</td>
<td align="center">string</td>
<td align="center">插件的版本号</td>
<td align="center">可选</td>
</tr>
<tr>
<td align="center">description</td>
<td align="center">string</td>
<td align="center">插件的描述信息</td>
<td align="center">可选</td>
</tr>
<tr>
<td align="center">site</td>
<td align="center">string</td>
<td align="center">插件的源地址</td>
<td align="center">可选</td>
</tr>
<tr>
<td align="center">language</td>
<td align="center">array of string</td>
<td align="center">插件支持的语言 (e.g. [‘cht’, ‘enu’])</td>
<td align="center">可选</td>
</tr>
<tr>
<td align="center">test_example</td>
<td align="center">JSON object</td>
<td align="center">此值可确保您的插件在您使用时可用上传或测试插件的连接。 这是一个测试_电影的例子：”movie”: {“title”: “Harry Potter”, “original_available”: “2001-11-16”}，如果插件支持电视剧类型的视频，这里提供一个相关类型的例子：”tvshow”: {“title”: “Game of Thrones”, “original_available”: “2011-04-17”},”tvshow_episode”: {“title”: “Game of Thrones”, “original_available”: “2011-04-17”, “season”: 1, “episode”: 1}</td>
<td align="center">必须</td>
</tr>
</tbody></table>
<h2 id="3-2-loader-sh"><a href="#3-2-loader-sh" class="headerlink" title="3.2 loader.sh"></a>3.2 loader.sh</h2><p>Video Station 将执行 loader.sh 以检索视频信息。 您可以使用 PHP 或 Python 3.x 搜索算法并在 loader.sh 中运行。 Video Station 将运行您的具有以下参数的插件： </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash loader.sh --<span class="built_in">type</span> movie --lang enu --input <span class="string">&quot;&#123;\&quot;title\&quot;:\&quot;Toy Story\&quot;, \&quot;original_available\&quot;: \&quot;1995-11-22\&quot;&#125;&quot;</span> --<span class="built_in">limit</span> 1 --allowguess <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>下表解释了 Video Station 传递的参数的详细信息</p>
<p><strong>表2. 发送给 loader.sh 的参数说明</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
<th align="center">是否必须</th>
</tr>
</thead>
<tbody><tr>
<td align="center">input</td>
<td align="center">JSON object</td>
<td align="center">查询输入必须是 JSON 对象，包括以下内容：title（必填）和 original_available（可选）。搜索电视剧集的信息时，必须包含 episode 和 season</td>
<td align="center">必须</td>
</tr>
<tr>
<td align="center">lang</td>
<td align="center">string</td>
<td align="center">首选语言（必须是以下任何一种：chs、cht, csy, dan, enu, fre, ger, hun, ita, jpn, krn, nld, nor, plk, ptb, ptg、rus、spn、sve、trk、tha)</td>
<td align="center">必须</td>
</tr>
<tr>
<td align="center">type</td>
<td align="center">string</td>
<td align="center">查询的视频类型, 必须是下列的一种: movie, tvshow, tvshow_episode</td>
<td align="center">必须</td>
</tr>
<tr>
<td align="center">limit</td>
<td align="center">int</td>
<td align="center">允许的最大结果数</td>
<td align="center">必须</td>
</tr>
<tr>
<td align="center">allowguess</td>
<td align="center">boolean</td>
<td align="center">如果 title guessing 功能支持的时候才可用</td>
<td align="center">可选</td>
</tr>
</tbody></table>
<blockquote>
<ol>
<li>如果电视剧的 season 值为 0，意味着这是季的特别篇（e.g. 日剧的SP）。如果输入的参数没有 tvshow_episode (集的信息)，意味着将获得 season 的全部集信息</li>
<li>标题猜测功能应该由插件实现。 可查看示例代码的 <code>searchinc.py</code> 的 <code>get_guessing_names</code> 方法 </li>
</ol>
</blockquote>
<h1 id="4-插件响应"><a href="#4-插件响应" class="headerlink" title="4. 插件响应"></a>4. 插件响应</h1><p>所有插件响应都应编码为 JSON 对象。 搜索结果插件由键 “success” 表示，其值可以是真/假（布尔值）取决于请求的状态</p>
<h2 id="4-1-成功响应"><a href="#4-1-成功响应" class="headerlink" title="4.1 成功响应"></a>4.1 成功响应</h2><p>成功的响应将包含 “success” 的键，值为 “true”, “result” 的值是 JSON 数组，内容因视频类型而异（例如，电影、电视节目、电视，显示剧集）</p>
<h3 id="4-1-1-电影"><a href="#4-1-1-电影" class="headerlink" title="4.1.1 电影"></a>4.1.1 电影</h3><p>电影的检索结果将包括以下属性：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;success&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;result&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Toy Story&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;tagline&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;original_available&quot;</span>: <span class="string">&quot;1995-10-30&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;original_title&quot;</span>: <span class="string">&quot;Toy Story&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;summary&quot;</span>: <span class="string">&quot;Led by Woody, Andy&#x27;s toys live happily in his room until Andy&#x27;s birthday brings Buzz Lightyear onto the scene. Afraid of losing his place in Andy&#x27;s heart, Woody plots against Buzz. But when circumstances separate Buzz and Woody from their owner, the duo eventually learns to put aside their differences.&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;certificate&quot;</span>: <span class="string">&quot;G&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;genre&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;Animation&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Adventure&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Family&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Comedy&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;actor&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;Tom Hanks&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;director&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;John Lasseter&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;writer&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;Andrew Stanton&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;extra&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;com.synology.TMDBExample&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;rating&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;com.synology.TMDBExample&quot;</span>: <span class="number">7.9</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;poster&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;https://image.tmdb.org/t/p/w500/uXDfjJbdP4ijW5hWSBrPrlKpxab.jpg&quot;</span></span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">&quot;backdrop&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;https://image.tmdb.org/t/p/original/3Rfvhy1Nl6sSGJwyjb0QiZzZYlB.jpg&quot;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-1-2-电视剧"><a href="#4-1-2-电视剧" class="headerlink" title="4.1.2 电视剧"></a>4.1.2 电视剧</h3><p>电视剧的搜索结果将包含以下属性：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;success&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;result&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Elementary&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;original_available&quot;</span>: <span class="string">&quot;2012-09-27&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;original_title&quot;</span>: <span class="string">&quot;Elementary&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;summary&quot;</span>: <span class="string">&quot;A modern-day drama about a crime-solving duo that cracks the NYPD&#x27;s most impossible cases. Following his fall from grace in London and a stint in rehab, eccentric Sherlock escapes to Manhattan where his wealthy father forces him to live with his worst nightmare - a sober companion, Dr. Watson.&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;extra&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;com.synology.TMDBExample&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;poster&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;https://image.tmdb.org/t/p/w500/q9dObe29W4bDpgzUfOOH3ZnzDbR.jpg&quot;</span></span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">&quot;backdrop&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;https://image.tmdb.org/t/p/original/7sJrNKwzyJWnFPFpDL9wnZ859LZ.jpg&quot;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-1-3-电视剧的集信息"><a href="#4-1-3-电视剧的集信息" class="headerlink" title="4.1.3 电视剧的集信息"></a>4.1.3 电视剧的集信息</h3><p>电视节目特定剧集的搜索结果将包括以下属性：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;success&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;result&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Elementary&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;tagline&quot;</span>: <span class="string">&quot;Pilot&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;original_available&quot;</span>: <span class="string">&quot;2012-09-27&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;summary&quot;</span>: <span class="string">&quot;Detective Sherlock Holmes, along with his sober companion, Dr. Joan Watson, uses his uncanny ability to read people and analyze crimes to assist the NYPD on some of their more difficult cases.&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;certificate&quot;</span>: <span class="string">&quot;TV-14&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;genre&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;Drama&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Mystery&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Crime&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;actor&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;Jonny Lee Miller&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Lucy Liu&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;director&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;Michael Cuesta&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;writer&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;Robert Doherty&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;season&quot;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;episode&quot;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;extra&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;com.synology.TheMovieDb&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;tvshow&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Elementary&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;original_available&quot;</span>: <span class="string">&quot;2012-09-27&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;original_title&quot;</span>: <span class="string">&quot;Elementary&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;summary&quot;</span>: <span class="string">&quot;A modern-day drama about a crime-solving duo that cracks the NYPD&#x27;s most impossible cases. Following his fall from grace in London and a stint in rehab, eccentric Sherlock escapes to Manhattan where his wealthy father forces him to live with his worst nightmare - a sober companion, Dr. Watson.&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;extra&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;com.synology.TMDBExample&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;poster&quot;</span>: [</span><br><span class="line">                  <span class="string">&quot;https://image.tmdb.org/t/p/w500/q9dObe29W4bDpgzUfOOH3ZnzDbR.jpg&quot;</span></span><br><span class="line">                ],</span><br><span class="line">                <span class="attr">&quot;backdrop&quot;</span>: [</span><br><span class="line">                  <span class="string">&quot;https://image.tmdb.org/t/p/original/7sJrNKwzyJWnFPFpDL9wnZ859LZ.jpg&quot;</span></span><br><span class="line">                ]</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;poster&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;https://image.tmdb.org/t/p/w500/14PEsYWrZGYaQONPxQHaHjqufK5.jpg&quot;</span></span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">&quot;rating&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;com.synology.TheMovieDb&quot;</span>: <span class="number">7.4</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-2-错误响应"><a href="#4-2-错误响应" class="headerlink" title="4.2 错误响应"></a>4.2 错误响应</h2><p>当 API 请求由于某些搜索错误而失败时，响应将包含键 “success”，值为 “false”，错误代码指示导致失败的条件</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;success&quot;</span>:<span class="literal">false</span>,<span class="attr">&quot;error_code&quot;</span>:<span class="number">1003</span>&#125;</span><br></pre></td></tr></table></figure>

<p>根据发生的错误类型，显示以下状态代码</p>
<table>
<thead>
<tr>
<th align="center">错误码</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1003</td>
<td align="center">该代码表示搜索失败。 例如，插件可能无法连接到源网站或无法检索请求的数据。</td>
</tr>
<tr>
<td align="center">1004</td>
<td align="center">该代码表示无法解析响应结果。 这可能是由于缺少必填信息或其他意外错误</td>
</tr>
</tbody></table>
<h1 id="5-打包你的插件"><a href="#5-打包你的插件" class="headerlink" title="5. 打包你的插件"></a>5. 打包你的插件</h1><p>应与文件夹名称和您的插件 ID 相同。 Video Station 将提取带有 tar 的 .tar 和带有 7z 的 .zip</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System<span class="comment"># tar --no-xattrs -cvf com.synology.TMDBExample.tar com.synology.TMDBExample</span></span><br><span class="line">System<span class="comment"># 7z a com.synology.TMDBExample.zip com.synology.TMDBExample</span></span><br></pre></td></tr></table></figure>

<h1 id="6-测试你的插件"><a href="#6-测试你的插件" class="headerlink" title="6. 测试你的插件"></a>6. 测试你的插件</h1><p>在开发阶段，您可以使用插件测试器检查您的插件是否有效</p>
<h2 id="6-1-快速测试"><a href="#6-1-快速测试" class="headerlink" title="6.1 快速测试"></a>6.1 快速测试</h2><p>此方法允许您测试插件的搜索功能。 测试你的插件功能齐全，请参阅完整测试部分。</p>
<ol>
<li><p>在插件测试器所在的位置安装 Video Station。</p>
</li>
<li><p>使用 File Station 将插件文件上传到 Synology NAS。</p>
</li>
<li><p>使用 nobody 权限输入以下命令来测试您的插件。</p>
</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u nobody  /var/packages/VideoStation/target/plugins/syno_plugin_tester/loader.sh --<span class="built_in">type</span> movie --lang enu --input <span class="string">&quot;&#123;\&quot;title\&quot;:\&quot;&#123;movie title&#125;\&quot;, \&quot;original_available\&quot;:\&quot;2001-11-16\&quot;&#125;&quot;</span> --<span class="built_in">limit</span> 1 --path <span class="string">&quot;<span class="variable">$&#123;entry file path of your search plugin&#125;</span>&quot;</span> --pluginid <span class="variable">$your</span> plugin id&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>如果插件验证通过，会收到成功响应：<code>&#123;&quot;success&quot;: true&#125;</code></li>
</ol>
<ol start="5">
<li>否则，<code>success</code> 的值为 <code>false</code>，并带有错误代码指示导致故障的条件</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;success&quot;</span>: <span class="literal">false</span>, <span class="attr">&quot;error_code&quot;</span>: <span class="number">1004</span>, <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;execute plugin fail&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p><strong>下面是插件测试器的参数说明</strong></p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">类型</th>
<th align="center">描述</th>
<th align="center">是否强制</th>
</tr>
</thead>
<tbody><tr>
<td align="center">input</td>
<td align="center">JSON object</td>
<td align="center">input 字段必须是 JSON object 并且包含下列内容: title (必填) 和 original_available (可选).  如果搜索的是 tvshow_episode, input 必须包含 episode 和 season</td>
<td align="center">必须</td>
</tr>
<tr>
<td align="center">lang</td>
<td align="center">string</td>
<td align="center">语言选项必须是下列中的一种 : chs, cht, csy, dan, enu, fre, ger, hun, ita, jpn, krn, nld, nor, plk, ptb, ptg, rus, spn, sve, trk, tha.</td>
<td align="center">必须</td>
</tr>
<tr>
<td align="center">type</td>
<td align="center">string</td>
<td align="center">查询视频的类型，必须是下列的一种: movie, tvshow, tvshow_episode.</td>
<td align="center">必须</td>
</tr>
<tr>
<td align="center">limit</td>
<td align="center">int</td>
<td align="center">插件返回的最大查询结果数</td>
<td align="center">必须</td>
</tr>
<tr>
<td align="center">path</td>
<td align="center">string</td>
<td align="center">入口文件的绝对路径</td>
<td align="center">必须</td>
</tr>
<tr>
<td align="center">pluginid</td>
<td align="center">string</td>
<td align="center">插件ID</td>
<td align="center">必须</td>
</tr>
</tbody></table>
<h2 id="6-2-完整测试"><a href="#6-2-完整测试" class="headerlink" title="6.2 完整测试"></a>6.2 完整测试</h2><p>完整测试你的插件， 你可以上传到 Video Station 使用 Chrome DevTools 来检查你插件的状态</p>
      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2021/12/6907dde1b0f1/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>上一页</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime" title="更新时间"></i>
              2022-03-12 21:07:00
            </span>
            
                  <span class="post-categories">
                    <i class="iconfont icon-bookmark" title="分类"></i>
                    
                    <span class="span--category">
                      <a href="/categories/%E6%8C%87%E5%8D%97/" title="指南">
                        <b>#</b> 指南
                      </a>
                    </span>
                    
                  </span>
              
                  <span class="post-tags">
                    <i class="iconfont icon-tags" title="标签"></i>
                    
                    <span class="span--tag">
                      <a href="/tags/%E7%BE%A4%E6%99%96/" title="群晖">
                        <b>#</b> 群晖
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/Video-Station/" title="Video Station">
                        <b>#</b> Video Station
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/%E7%BF%BB%E8%AF%91/" title="翻译">
                        <b>#</b> 翻译
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
              <a href="/2022/04/12fb008f68d1/" target="_self">
                <span>下一页</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">目录</div>
    <div class="catalog-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E4%BB%8B%E7%BB%8D"><span class="toc-text">1. 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%85%B3%E4%BA%8E%E8%A7%86%E9%A2%91%E4%BF%A1%E6%81%AF%E6%8F%92%E4%BB%B6"><span class="toc-text">1.1 关于视频信息插件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E4%BF%A1%E6%81%AF%E6%90%9C%E7%B4%A2%E6%B5%81%E7%A8%8B"><span class="toc-text">2. 信息搜索流程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E8%A7%A6%E5%8F%91%E8%A7%86%E9%A2%91%E4%BF%A1%E6%81%AF%E6%90%9C%E7%B4%A2"><span class="toc-text">2.1 触发视频信息搜索</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E8%BD%AC%E6%8D%A2-INFO-%E6%96%87%E4%BB%B6"><span class="toc-text">2.2 转换 INFO 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E8%BF%90%E8%A1%8C%E6%8F%92%E4%BB%B6"><span class="toc-text">2.3 运行插件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%96%87%E4%BB%B6%E8%A6%81%E6%B1%82"><span class="toc-text">3. 文件要求</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-INFO"><span class="toc-text">3.1 INFO</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-loader-sh"><span class="toc-text">3.2 loader.sh</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E6%8F%92%E4%BB%B6%E5%93%8D%E5%BA%94"><span class="toc-text">4. 插件响应</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E6%88%90%E5%8A%9F%E5%93%8D%E5%BA%94"><span class="toc-text">4.1 成功响应</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E7%94%B5%E5%BD%B1"><span class="toc-text">4.1.1 电影</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-%E7%94%B5%E8%A7%86%E5%89%A7"><span class="toc-text">4.1.2 电视剧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-3-%E7%94%B5%E8%A7%86%E5%89%A7%E7%9A%84%E9%9B%86%E4%BF%A1%E6%81%AF"><span class="toc-text">4.1.3 电视剧的集信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E9%94%99%E8%AF%AF%E5%93%8D%E5%BA%94"><span class="toc-text">4.2 错误响应</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E6%89%93%E5%8C%85%E4%BD%A0%E7%9A%84%E6%8F%92%E4%BB%B6"><span class="toc-text">5. 打包你的插件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E6%B5%8B%E8%AF%95%E4%BD%A0%E7%9A%84%E6%8F%92%E4%BB%B6"><span class="toc-text">6. 测试你的插件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E5%BF%AB%E9%80%9F%E6%B5%8B%E8%AF%95"><span class="toc-text">6.1 快速测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E5%AE%8C%E6%95%B4%E6%B5%8B%E8%AF%95"><span class="toc-text">6.2 完整测试</span></a></li></ol></li></ol>
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
  </div>


        <div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/olddoge">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Copyright © Oranges 2021</a>
        
    </div>
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="搜索...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>首次搜索，正在载入索引文件，请稍后……<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>没有找到内容，请尝试更换检索词。<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>未找到search.xml文件，具体请参考：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>请求失败，尝试重新刷新页面或稍后重试。<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        

      </div>
    </div>
  <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body>
</html>
